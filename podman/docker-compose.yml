services:
 mongodb:
   image: docker.repo1.uhc.com/mongo:6.0
   container_name: mongodb
   restart: always
   ports:
     - "27017:27017"
   environment:
     MONGO_INITDB_ROOT_USERNAME: admin
     MONGO_INITDB_ROOT_PASSWORD: admin123
   volumes:
     - mongodb_data:/data/db
   healthcheck:
     test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/test --quiet
     interval: 10s
     timeout: 5s
     retries: 5
     start_period: 40s

 prometheus:
   image: docker.repo1.uhc.com/prom/prometheus:latest
   container_name: prometheus
   restart: always
   ports:
     - "9090:9090"
   volumes:
     - ./prometheus.yml:/etc/prometheus/prometheus.yml
     - prometheus_data:/prometheus
   command:
     - '--config.file=/etc/prometheus/prometheus.yml'
     - '--storage.tsdb.path=/prometheus'
     - '--web.console.libraries=/etc/prometheus/console_libraries'
     - '--web.console.templates=/etc/prometheus/consoles'
     - '--storage.tsdb.retention.time=200h'
     - '--web.enable-lifecycle'
   healthcheck:
     test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9090/"]
     interval: 30s
     timeout: 10s
     retries: 3
     start_period: 30s
   depends_on:
     - mongodb

volumes:
  mongodb_data:
  prometheus_data: